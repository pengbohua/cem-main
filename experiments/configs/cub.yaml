trials: 1
results_dir: results/cub_complete/

shared_params:
  results_dir: "results/cub_complete/"
  trials: 1
  model_selection_trials: 1
  dataset_config:
    dataset: "cub"
    num_workers: 8
    batch_size: 128
    root_dir: "cem/data/CUB200" # REPLACE ME
    sampling_percent: 1
    sampling_groups: true
    test_subsampling: 1
    weight_loss: true
  intervention_config:
    competence_levels: [1]
    intervention_freq: 1
    intervention_batch_size: 128
    val_intervention_policies:
      - policy: "random"
        group_level: true
        use_prior: false
    intervention_policies:
      - policy: "random"
        group_level: true
        use_prior: false
      # Remove the following if you are only interested in random interventions
      - policy: "random"
        group_level: true
        use_prior: true
        include_run_names: [".*(IntCEM).*"]
      - policy: "coop"
        group_level: true
        use_prior: false
      - policy: "behavioural_cloning"
        group_level: true
        use_prior: false
      - policy: "optimal_greedy"
        group_level: true
        use_prior: false
      - policy: "global_val_error"
        group_level: true
        use_prior: false
      - policy: "global_val_improvement"
        group_level: true
        use_prior: false
      ##########################################################################
  eval_config:
    additional_metrics:
      - name: "mixcem_sel"
        include_list: [".*(MixCEM).*"]
    additional_test_sets:
      - name: "OOD_sap_0.01"
        update_previous: true
        dataset_config:
          test_transformation_config:
            post_generation: false
            name: "salt_and_pepper"
            amount: 0.01
            s_vs_p: 0.5

      - name: "OOD_sap_0.1"
        update_previous: true
        dataset_config:
          test_transformation_config:
            post_generation: false
            name: "salt_and_pepper"
            amount: 0.1
            s_vs_p: 0.5


  skip_repr_evaluation: true
  max_epochs: 50
  top_k_accuracy: null
  save_model: true
  patience: 15
  emb_size: 16
  extra_dims: 0
  concept_loss_weight: [1, 5, 10]
  learning_rate: 0.01
  weight_decay: 4.0e-06
  weight_loss: true
  c_extractor_arch: "resnet18"
  optimizer: "sgd"
  bool: false
  early_stopping_monitor: "val_loss"
  early_stopping_mode: "min"
  early_stopping_delta: 0.0
  momentum: 0.9
  sigmoidal_prob: false
  training_intervention_prob: 0
  num_load_workers: 8
runs:
  - architecture: "MixCEM"
    run_name: "MixCEM KL"
    concept_loss_weight: 1
    training_intervention_prob: 0.25
    load_path_name: "MixCEM_r_1_g_ood_0.9_cwl_1_ce_0"
    all_intervened_loss_weight: 1
    ood_dropout_prob: 0.9
    kl_ratio: 0.1
    beta_max: 10
    calibration_epochs: 0

  - architecture: "MixCEM"
    run_name: "MixCEM NO KL"
    concept_loss_weight: 1
    training_intervention_prob: 0.25
    load_path_name: "MixCEM_r_1_g_ood_0.9_cwl_1_ce_0_no_kl"
    all_intervened_loss_weight: 1
    ood_dropout_prob: 0.9
    kl_ratio: 0.0
    beta_max: 10
    calibration_epochs: 0

  - architecture: "ConceptBottleneckModel"
    run_name: "Joint Logit CBM Bayes"
    concept_loss_weight: 10
    kl_ratio: 0.01
    beta_max: 10
    sample_c_preds: true
    embedding_activation: "leakyrelu"
    sigmoidal_extra_capacity: false

  - architecture: "ConceptBottleneckModel"
    run_name: "Joint Logit CBM Det"
    concept_loss_weight: 10
    kl_ratio: 0.0
    beta_max: 10
    sample_c_preds: false
    embedding_activation: "leakyrelu"
    sigmoidal_extra_capacity: false

  - architecture: "ConceptBottleneckModel"
    run_name: "Joint CBM Bayes"
    concept_loss_weight: 10
    kl_ratio: 0.01
    beta_max: 10
    sample_c_preds: true
    sigmoidal_prob: true
    embedding_activation: "leakyrelu"
    sigmoidal_extra_capacity: false

  - architecture: "ConceptBottleneckModel"
    run_name: "Joint CBM Det"
    concept_loss_weight: 10
    kl_ratio: 0.0
    beta_max: 10
    sample_c_preds: false
    sigmoidal_prob: true
    embedding_activation: "leakyrelu"
    sigmoidal_extra_capacity: false


  - architecture: "ConceptBottleneckModel"
    run_name: "DNN Det"
    extra_dims: 0
    kl_ratio: 0.0
    sample_c_preds: false
    beta_max: 10
    concept_loss_weight: 0
    sigmoidal_prob: true
    embedding_activation: "leakyrelu"

  - architecture: "ConceptBottleneckModel"
    run_name: "DNN Det"
    extra_dims: 0
    kl_ratio: 0.01
    sample_c_preds: true
    beta_max: 10
    concept_loss_weight: 0
    sigmoidal_prob: true
    embedding_activation: "leakyrelu"



trials: 1
results_dir: results/cifar10_complete_125/

shared_params:
  results_dir: "results/cifar10_complete_125/"
  trials: 1
  model_selection_trials: 3
  dataset_config:
    dataset: "cifar10"
    num_workers: 8
    batch_size: 512
    binarization_mode: "percentile_threshold"
    regenerate: true
    threshold: 50
    root_dir: "cem/data/cifar10" # REPLACE ME
    sampling_percent: 1
    sampling_groups: true
    test_subsampling: 1
    weight_loss: true
  intervention_config:
    competence_levels: [1]
    intervention_freq: 11
    intervention_batch_size: 512
    val_intervention_policies:
      - policy: "random"
        group_level: true
        use_prior: false
    intervention_policies:
      - policy: "random"
        group_level: true
        use_prior: false
  eval_config:
    additional_metrics: []
    additional_test_sets: []
  check_val_every_n_epoch: 1
  skip_repr_evaluation: true
  max_epochs: 50
  top_k_accuracy: null
  save_model: true
  patience: 15
  emb_size: 16
  extra_dims: 0
  concept_loss_weight: [10, 1]
  learning_rate: 0.01
  weight_decay: 1.0e-06
  weight_loss: true
  warmup_epochs: 5
  c_extractor_arch: "resnet18"
  optimizer: "sgd"
  bool: false
  early_stopping_monitor: "val_loss"
  early_stopping_mode: "min"
  early_stopping_delta: 0.0
  momentum: 0.9
  sigmoidal_prob: false
  training_intervention_prob: 0
  num_load_workers: 8
runs:
  - architecture: "MixCEM"
    run_name: "MixCEM KL"
    max_epochs: 150
    concept_loss_weight: 1
    training_intervention_prob: 0.25
    sample_c_preds: true
    kl_ratio: 0.01
    beta_max: 10
    load_path_name: "MixCEM_r_0.1_g_ood_0.5_cwl_1_ce_0"
    all_intervened_loss_weight: 0.1
    ood_dropout_prob: 0.5
    calibration_epochs: 0
    topk_concepts_path: "cem/data/cocnepts_of_classes/cifar10/top8_indices.pt"
  # - architecture: "ConceptBottleneckModel"
  #   run_name: "Joint CBM"
  #   concept_loss_weight: 10
  #   sigmoidal_prob: true
  #   embedding_activation: "leakyrelu"
  #   sigmoidal_extra_capacity: false
  #   topk_concepts_path: "cem/data/cocnepts_of_classes/cifar10/top8_indices.pt"

  # - architecture: "ConceptBottleneckModel"
  #   run_name: "Joint Logit CBM"
  #   concept_loss_weight: 10
  #   embedding_activation: "leakyrelu"
  #   sigmoidal_extra_capacity: false
  #   topk_concepts_path: "cem/data/cocnepts_of_classes/cifar10/top8_indices.pt"

  # - architecture: "SequentialConceptBottleneckModel"
  #   run_name: "Sequential CBM"
  #   concept_loss_weight: 1
  #   sigmoidal_prob: true
  #   embedding_activation: "leakyrelu"
  #   sigmoidal_extra_capacity: false
  #   topk_concepts_path: "cem/data/cocnepts_of_classes/cifar10/top8_indices.pt"

  # - architecture: "IndependentConceptBottleneckModel"
  #   run_name: "Independent CBM"
  #   concept_loss_weight: 1
  #   sigmoidal_prob: true
  #   embedding_activation: "leakyrelu"
  #   sigmoidal_extra_capacity: false
  #   topk_concepts_path: "cem/data/cocnepts_of_classes/cifar10/top8_indices.pt"

#  - architecture: "ConceptEmbeddingModel"
#    run_name: "CEM"
#    concept_loss_weight: 1
#    sigmoidal_prob: true
#    training_intervention_prob: 0.25
#    embedding_activation: "leakyrelu"
#
#  - architecture: "ProbabilisticConceptBottleneckModel"
#    run_name: "ProbCBM"
#    concept_loss_weight: 1
#    n_samples_inference: 50
#    use_neg_concept: true
#    pred_class: true
#    init_negative_scale: 5
#    init_shift: 5
#    pretrained: true
#    hidden_dim: 16
#    class_hidden_dim: 64
#    intervention_prob: 0.5
#    gradient_clip_val: 2.0
#    max_concept_epochs: 50
#    warmup_epochs: 5
#    max_task_epochs: 50
#    vib_beta: 5.0e-05
#    lr_ratio: 10

